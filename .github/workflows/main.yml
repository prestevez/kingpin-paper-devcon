name: Pre-build and push devcontainer image to registry
on: [push]
jobs: 
  pre-build-dev-container:
    runs-on: ubuntu-latest
    steps:
      - name: Set version var
        uses: actions/checkout@v3
      - run: | 
          source VERSION
          VER=$VMAJOR.$VMINOR.$VPATCH.${GITHUB_SHA:0:7}
          echo "VERSION=$VER" >> $GITHUB_ENV
      - run: |
          source R_PACKAGES
          echo "PACKAGES=$PACKAGES" >> $GITHUB_ENV 
      - uses: devcontainers/ci@v0.3
        with: 
          imageName: ghcr.io/prestevez/kingpin-paper
          imageTag: latest,${{ env.VERSION }}
          skipContainerUserIdUpdate: true
          push: never
      - run: |
          docker image list -a
